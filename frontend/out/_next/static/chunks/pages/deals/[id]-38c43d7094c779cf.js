(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[558],{7464:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/deals/[id]",function(){return t(5130)}])},3736:function(e,s,t){"use strict";t.d(s,{F$:function(){return d},Q5:function(){return c},qE:function(){return n}});var a=t(5893),r=t(7294),l=t(952),i=t(3161);let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.fC,{ref:s,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})});n.displayName=l.fC.displayName;let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.Ee,{ref:s,className:(0,i.cn)("aspect-square h-full w-full",t),...r})});d.displayName=l.Ee.displayName;let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.NY,{ref:s,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r})});c.displayName=l.NY.displayName},9889:function(e,s,t){"use strict";t.d(s,{Ol:function(){return n},Zb:function(){return i},aY:function(){return c},eW:function(){return u},ll:function(){return d}});var a=t(5893),r=t(7294),l=t(3161);let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});i.displayName="Card";let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...r})});n.displayName="CardHeader";let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});d.displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",t),...r})}).displayName="CardDescription";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",t),...r})});c.displayName="CardContent";let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",t),...r})});u.displayName="CardFooter"},529:function(e,s,t){"use strict";t.d(s,{SP:function(){return c},dr:function(){return d},mQ:function(){return n},nU:function(){return u}});var a=t(5893),r=t(7294),l=t(681),i=t(3161);let n=l.fC,d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.aV,{ref:s,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-slate-100 p-1 text-slate-500 dark:bg-slate-800 dark:text-slate-400",t),...r})});d.displayName=l.aV.displayName;let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.xz,{ref:s,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-slate-950 data-[state=active]:shadow-sm dark:ring-offset-slate-950 dark:focus-visible:ring-slate-800 dark:data-[state=active]:bg-slate-950 dark:data-[state=active]:text-slate-50",t),...r})});c.displayName=l.xz.displayName;let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.VY,{ref:s,className:(0,i.cn)("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2 dark:ring-offset-slate-950 dark:focus-visible:ring-slate-800",t),...r})});u.displayName=l.VY.displayName},4960:function(e,s,t){"use strict";t.d(s,{W:function(){return i}});var a=t(109),r=t(3898);class l{async getUserProfile(e){let s=(0,a.JU)(r.db,"users",e),t=await (0,a.QT)(s);return t.exists()?t.data():null}async updateUserProfile(e,s){let t=(0,a.JU)(r.db,"users",e);await (0,a.r7)(t,{...s,updatedAt:(0,a.Bt)()})}async saveDeal(e,s){let t=(0,a.JU)(r.db,"users",e);await (0,a.r7)(t,{savedDeals:(0,a.vr)(s),updatedAt:(0,a.Bt)()})}async unsaveDeal(e,s){let t=(0,a.JU)(r.db,"users",e);await (0,a.r7)(t,{savedDeals:(0,a.Ab)(s),updatedAt:(0,a.Bt)()})}async getSavedDeals(e){var s;let t=(0,a.JU)(r.db,"users",e),l=(null===(s=(await (0,a.QT)(t)).data())||void 0===s?void 0:s.savedDeals)||[];if(0===l.length)return[];let i=(0,a.hJ)(r.db,"deals"),n=[];for(let e=0;e<l.length;e+=10)n.push(l.slice(e,e+10));let d=[];for(let e of n){let s=(0,a.IO)(i,(0,a.ar)("__name__","in",e)),t=await (0,a.PL)(s);d.push(...t.docs.map(e=>({id:e.id,...e.data()})))}return d}async getPreferences(e){var s;let t=(0,a.JU)(r.db,"users",e);return(null===(s=(await (0,a.QT)(t)).data())||void 0===s?void 0:s.preferences)||{}}async updatePreferences(e,s){let t=(0,a.JU)(r.db,"users",e);await (0,a.r7)(t,{preferences:s,updatedAt:(0,a.Bt)()})}async createInitialUserProfile(e,s){let t=(0,a.JU)(r.db,"users",e);await (0,a.pl)(t,{...s,savedDeals:[],preferences:{},createdAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()})}}let i=new l},5130:function(e,s,t){"use strict";t.r(s),t.d(s,{__N_SSG:function(){return y},default:function(){return b}});var a=t(5893),r=t(7294),l=t(1163),i=t(9889),n=t(529),d=t(2292),c=e=>{let{value:s,onChange:t,size:r="md"}=e,l={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"};return(0,a.jsx)("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>t(e),className:"focus:outline-none",children:(0,a.jsx)(d.Z,{className:"".concat(l[r]," ").concat(e<=s?"fill-yellow-400 text-yellow-400":"fill-gray-200 text-gray-200"," transition-colors")})},e))})},u=t(354),o=t(3161);let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...r})});f.displayName="Textarea";var x=t(8885),m=t(4960),v=e=>{let{dealId:s,onSuccess:t}=e,[l,n]=(0,r.useState)(0),[d,o]=(0,r.useState)(""),[v,h]=(0,r.useState)(!1),{user:p}=(0,x.a)(),j=async e=>{if(e.preventDefault(),p){h(!0);try{await m.W.addReview(p.uid,s,{rating:l,comment:d}),n(0),o(""),t&&t()}catch(e){console.error("Error submitting review:",e)}finally{h(!1)}}};return(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"Write a Review"})}),(0,a.jsxs)("form",{onSubmit:j,children:[(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Rating"}),(0,a.jsx)(c,{value:l,onChange:n})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Review"}),(0,a.jsx)(f,{value:d,onChange:e=>o(e.target.value),placeholder:"Share your thoughts about this deal...",rows:4})]})]}),(0,a.jsx)(i.eW,{children:(0,a.jsx)(u.z,{type:"submit",disabled:v||!l,children:v?"Submitting...":"Submit Review"})})]})]})},h=t(3736),p=t(9477),j=t(2558),g=e=>{let{dealId:s}=e,[t,l]=(0,r.useState)([]),[n,d]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{try{let e=await m.W.getReviews(s);l(e)}catch(e){console.error("Error loading reviews:",e)}finally{d(!1)}})()},[s]),n)?(0,a.jsx)("div",{children:"Loading reviews..."}):(0,a.jsx)(p.x,{className:"h-[400px]",children:(0,a.jsx)("div",{className:"space-y-4",children:0===t.length?(0,a.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No reviews yet. Be the first to review this deal!"}):t.map(e=>(0,a.jsx)(i.Zb,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsxs)(h.qE,{children:[(0,a.jsx)(h.F$,{src:e.user.avatar}),(0,a.jsx)(h.Q5,{children:e.user.name[0]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.user.name}),(0,a.jsx)(c,{value:e.rating,size:"sm"})]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:(0,j.Q)(e.createdAt.toDate(),{addSuffix:!0})})]}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:e.comment})]})]})},e.id))})})},N=e=>{let{dealId:s}=e,[t,l]=(0,r.useState)({average:0,total:0,distribution:{1:0,2:0,3:0,4:0,5:0}});return(0,r.useEffect)(()=>{(async()=>{let e=await m.W.getReviews(s),t=e.reduce((e,s)=>(e[s.rating]=(e[s.rating]||0)+1,e),{}),a=e.length;l({average:a>0?e.reduce((e,s)=>e+s.rating,0)/a:0,total:a,distribution:t})})()},[s]),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"text-4xl font-bold",children:t.average.toFixed(1)}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{value:Math.round(t.average),size:"lg"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[t.total," reviews"]})]})]}),(0,a.jsx)("div",{className:"space-y-2",children:[5,4,3,2,1].map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"w-4",children:e}),(0,a.jsx)(d.Z,{className:"h-4 w-4 text-yellow-400"}),(0,a.jsx)("div",{className:"flex-1 h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-yellow-400",style:{width:"".concat(t.distribution[e]/t.total*100||0,"%")}})}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:t.distribution[e]||0})]},e))})]})},w=t(3055),y=!0;function b(){let{id:e}=(0,l.useRouter)().query;return e?(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:(0,a.jsxs)("div",{className:"lg:col-span-2",children:[(0,a.jsx)(w.Z,{id:e}),(0,a.jsx)(i.Zb,{className:"mt-8",children:(0,a.jsxs)(n.mQ,{defaultValue:"details",children:[(0,a.jsxs)(n.dr,{children:[(0,a.jsx)(n.SP,{value:"details",children:"Details"}),(0,a.jsx)(n.SP,{value:"reviews",children:"Reviews"})]}),(0,a.jsx)(n.nU,{value:"details",children:(0,a.jsx)(i.aY,{})}),(0,a.jsx)(n.nU,{value:"reviews",children:(0,a.jsxs)(i.aY,{className:"space-y-6",children:[(0,a.jsx)(N,{dealId:e}),(0,a.jsx)(v,{dealId:e}),(0,a.jsx)(g,{dealId:e})]})})]})})]})})}):null}}},function(e){e.O(0,[133,834,214,55,774,888,179],function(){return e(e.s=7464)}),_N_E=e.O()}]);